#!/usr/bin/env bash

if ! which 2ms &>/dev/null
then
  echo "Cannot find the '2ms' executable"
  echo "You cannot commit without first scanning for secrets via '2ms'"
  exit 1
fi

echo "Scanning for secrets with '2ms'"


2ms filesystem --path . --config 2ms.yml
c=$?

echo "2ms exit code: $c"

[ $c = 0 ] && exit 0 # all good

## if we didn't exit above, something is wrong
echo "==="
echo "SECRETS FOUND, REFUSING TO COMMIT!"
exit 1
